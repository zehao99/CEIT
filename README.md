# CEIT

## Overview

## Configure the caculation

You should configure the `config.json` file before using this package.

A `.fem` file is needed for initializing the whole process. You can get one by using CAD software.

Also, you have to decide your electrode center positions, and your radius of the electrode.
Inside this package, the electrode is square shaped for which the radius means **half width** of the square.

```json
{
    "mesh_filename": "EITmesh.fem",
    "optimize_node_num": false,
    "shuffle_element": false,
    "electrode_centers": [
        [47,0],[47,23.5],[47,47],
        [23.5,47],[0,47],[-23.5,47],[-47,47],
        [-47,23.5],[-47,0],[-47,-23.5],[-47,-47],
        [-23.5,-47],[0,-47],[23.5,-47],[47,-47],
        [47,-23.5]
    ],
    "electrode_radius": 3,
    "reconstruction_mode": "n",
    "capacitance_change_for_JAC": 1e-3,
    "overall_origin_capacitance": 0,
    "detection_bound": 45,
    "Is_first_JAC_calculation": true,
    "folder_name": "Mesh_50_50", 
    "calc_from": 0,
    "calc_end": 16,
    "regularization_coeff": 295
}
```

## Quick Start

Here is a sample for simple forward calculation using this package.

```python
import matplotlib.pyplot as plt
from MyEIT.efem import EFEM
from MyEIT.readmesh import read_mesh_from_csv_SI

""" Read mesh from csv files(after initialization) """
read_mesh = read_mesh_from_csv_SI()
mesh_obj, electrode_num, electrode_centers, radius = read_mesh.return_mesh()
# extract node, element, alpha
""" problem setup """
fwd = EFEM(mesh_obj, electrode_num, electrode_centers, radius, perm=1 / 200000)
fwd.change_add_capa_geometry([-0.02, -0.01], 0.01, 1e-7, 'square')
node_u, elem_u, electrode_potential = fwd.calculation(2)

print(electrode_potential)
# Visualization
fig, ax = plt.subplots(figsize=(3.2, 3.2))
im = fwd.plot_potential_map(ax)
plt.colorbar(im)
plt.show()
```

## Read Mesh Class

All the mesh initializer is put in `MyEIT.readmesh`.

Now the reader only work with `.fem` files generated by Altair HyperMesh

### 1. Initialize a new mesh
First you should finish configuring your `config.json` file according to the previous paragraph.

Then on the first time running of a new mesh, call `init_mesh()` function to initialize mesh.

When initializing, the class will automatically clear out duplicated mesh and you can decide whether it 
should shuffle the mesh number or not.

After initializing, in the folder you specified before, the method would generate a `Mesh_Cache_Node.csv` 
file and a `Mesh_Cache_Element.csv` file.

```python
from MyEIT.readmesh import init_mesh

init_mesh(draw=True)
```

### 2. Read from generated mesh cache

After initializing the mesh, you can quickly read from the cache file.

There are two options regarding the length unit.

`read_mesh_from_csv` is in **mm** and `read_mesh_from_csv_SI` is in SI unit.

You need to call `return_mesh` method to get the mesh object and electrode information.

```python
from MyEIT.readmesh import read_mesh_from_csv_SI

read_mesh = read_mesh_from_csv_SI()
mesh_obj, electrode_num, electrode_centers, radius = read_mesh.return_mesh()
```

## Forward Calculator

## Jacobian Constructor

## Realtime Solver
